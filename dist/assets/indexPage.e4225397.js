import{j as e,k as a,u as t,l as s,g as o,r as n,m as l,o as i,c as u,n as d,w as c,v as r,F as p,p as v,a as C,T as m,q as g,s as f,t as h,x as w,y as M,z as k,A as y,B as b}from"./vendor.6bb3a353.js";import{u as x,g as B,c as j,a as _,d as L}from"./mindMap.48115e48.js";import{u as I}from"./token.fb9cb3d2.js";import{i as E}from"./login.95625e44.js";import"./userCenter.0654c2bb.js";const S=e("mindMapList",(()=>({mindMapList:a([]),setMindMapList:e=>{mindMap.value=e},removeMindMapList:()=>{mindMap.value={}}})),{persist:!0});const U={class:"wrap",ref:"wrap"},A={class:"header"},F={class:"center"},V={class:"main"},Z={class:"table"},H={class:"item"},$=["onClick"],q=["src"],z={class:"optMenuItem"},P={__name:"indexPage",setup(e){const P=x(),T=S(),W=t(),D=a([]);async function G(){await B().then((e=>{console.log(e),D.value=e.data,T.mindMapList=e.data})).catch((e=>{o({message:"获取列表状态失败",type:"error",duration:2500,offset:45})}))}const J=a("");async function K(){console.log("搜索思维导图:",J.value),await B(J.value).then((e=>{console.log(e),D.value=e.data,e.data.length<=0&&o({message:`没有找到“${J.value}”的结果`,type:"error",duration:2500,offset:45})})).catch((e=>{o({message:e.message,type:"error",duration:2500,offset:45})}))}const N=a(!1),O=a(""),Q=a(!1);function R(){N.value=!0}function X(){N.value=!1}const Y={};async function ee(){Q.value=!0,await j(O.value,Y).then((e=>{console.log(e),G(),P.removeMindMap(),P.setMindMap(e.data),o({message:"创建成功",type:"success",duration:2500,offset:45,onClose:()=>{Q.value=!1,W.push("/mindMap")}})})).catch((e=>{console.log(e),Q.value=!1,o({message:"创建失败",type:"error",duration:2500,offset:45})}))}const ae=a(!1),te=a(!1),se=a({});function oe(e,a){const t=document.getElementById(`optMap${a}`);D.value.forEach(((e,t)=>{t!==a&&(e.optMapShow=!1)})),te.value?(t.style.transform="rotate(0deg)",te.value=!1,ae.value=!1):(t.style.transform="rotate(180deg)",ae.value=!0,te.value=!0,se.value=e,console.log(se.value))}function ne(){W.push("/userCenter")}const le=I();return s((async()=>{D.value=T.mindMapList;let e=await E();e?(""!==le.token&&o({message:"登录已过期，请重新登录",type:"error",duration:2500,offset:45}),W.push("/login")):!1===e&&await G(),console.log(D),document.addEventListener("deviceready",(()=>{window.StatusBar.backgroundColorByHexString("#5ebaf9"),window.innerWidth<=787?window.screen.orientation.lock("portrait"):window.screen.orientation.lock("landscape")}),!1)})),(e,a)=>{const t=n("el-icon"),s=l("loading");return i(),u("div",U,[d("div",A,[d("div",{class:"left",onClick:ne},a[9]||(a[9]=[d("svg",{width:"35",height:"35",viewBox:"0 0 35 35",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[d("path",{d:"M9.59286 22.5779C7.52932 23.8058 2.1189 26.3141 5.41474 29.4539C7.02328 30.9866 8.81557 32.0833 11.0687 32.0833H23.9283C26.1829 32.0833 27.9752 30.9866 29.5837 29.4539C32.8795 26.3141 27.4691 23.8058 25.4056 22.5779C23.0107 21.1631 20.2801 20.4168 17.4985 20.4168C14.7169 20.4168 11.9878 21.1631 9.59286 22.5779ZM24.0624 9.47913C24.0624 11.2196 23.371 12.8888 22.1403 14.1195C20.9096 15.3502 19.2404 16.0416 17.4999 16.0416C15.7595 16.0416 14.0903 15.3502 12.8596 14.1195C11.6288 12.8888 10.9374 11.2196 10.9374 9.47913C10.9374 7.73864 11.6288 6.06945 12.8596 4.83874C14.0903 3.60803 15.7595 2.91663 17.4999 2.91663C19.2404 2.91663 20.9096 3.60803 22.1403 4.83874C23.371 6.06945 24.0624 7.73864 24.0624 9.47913Z",stroke:"#1A1A1A","stroke-width":"2.66667","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])),d("div",F,[a[10]||(a[10]=d("div",{class:"searchIcon"},[d("svg",{width:"40",height:"40",viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[d("path",{d:"M38 38L29.3 29.3M34 18C34 26.8366 26.8366 34 18 34C9.16344 34 2 26.8366 2 18C2 9.16344 9.16344 2 18 2C26.8366 2 34 9.16344 34 18Z",stroke:"#1E1E1E","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),c(d("input",{class:"searchInput",type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>J.value=e),onBlur:K},null,544),[[r,J.value]])]),a[11]||(a[11]=d("div",{class:"right"},null,-1))]),d("div",V,[d("div",Z,[(i(!0),u(p,null,v(D.value,((e,a)=>(i(),u("div",H,[d("div",{class:"pic",onClick:a=>{return t=e,console.log(t),P.removeMindMap(),P.setMindMap(t),console.log(P.mindMap),void W.push("/mindMap");var t}},[d("img",{class:"img",src:e.data.picUrl,alt:""},null,8,q)],8,$),d("span",null,[f(h(e.title)+" ",1),C(t,{onClick:a=>oe(e,e.id),id:"optMap"+e.id},{default:g((()=>[C(w(M))])),_:2},1032,["onClick","id"])])])))),256)),d("div",{class:"addItem",onClick:R},a[12]||(a[12]=[d("div",{class:"pic"},[d("svg",{width:"35",height:"35",viewBox:"0 0 35 35",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[d("path",{d:"M20.7608 7.7175C20.7608 6.95917 20.7608 6.58 20.6777 6.26938C20.5662 5.85483 20.3477 5.47685 20.0442 5.1733C19.7407 4.86975 19.3627 4.65129 18.9481 4.53979C18.1285 4.32104 16.8715 4.32104 16.0519 4.53979C15.6371 4.65107 15.2588 4.86943 14.955 5.173C14.6511 5.47656 14.4325 5.85465 14.3208 6.26938C14.2377 6.58 14.2377 6.95917 14.2377 7.7175C14.2377 9.25459 14.2377 13.284 13.7594 13.7608C13.2825 14.2392 9.25312 14.2392 7.71604 14.2392C6.95771 14.2392 6.57854 14.2392 6.26791 14.3223C5.85336 14.4338 5.47539 14.6523 5.17184 14.9558C4.86829 15.2594 4.64983 15.6373 4.53833 16.0519C4.31958 16.8715 4.31958 18.13 4.53833 18.9481C4.76437 19.7925 5.42354 20.4502 6.26791 20.6777C6.57854 20.7608 6.95771 20.7608 7.71604 20.7608C9.25312 20.7608 13.2825 20.7608 13.7594 21.2377C14.2377 21.716 14.2377 22.4846 14.2377 24.0231C14.2377 24.78 14.2377 28.42 14.3208 28.7306C14.4323 29.1452 14.6508 29.5232 14.9543 29.8267C15.2579 30.1303 15.6359 30.3487 16.0504 30.4602C16.87 30.679 18.1285 30.679 18.9467 30.4602C19.3612 30.3487 19.7392 30.1303 20.0427 29.8267C20.3463 29.5232 20.5648 29.1452 20.6762 28.7306C20.7594 28.42 20.7594 24.78 20.7594 24.0217C20.7594 22.4846 20.7594 21.716 21.2362 21.2377C21.7146 20.7608 25.744 20.7608 27.281 20.7608C28.0394 20.7608 28.4185 20.7608 28.7292 20.6777C29.1437 20.5662 29.5217 20.3478 29.8252 20.0442C30.1288 19.7407 30.3473 19.3627 30.4587 18.9481C30.6775 18.1285 30.6775 16.8715 30.4587 16.0519C30.3473 15.6373 30.1288 15.2594 29.8252 14.9558C29.5217 14.6523 29.1437 14.4338 28.7292 14.3223C28.4185 14.2392 28.0394 14.2392 27.281 14.2392C25.744 14.2392 21.7146 14.2392 21.2377 13.7608C20.7594 13.284 20.7594 9.25459 20.7594 7.7175","stroke-linecap":"round","stroke-linejoin":"round"})])],-1),d("span",null,"新建...",-1)]))])]),C(m,{name:"fade"},{default:g((()=>[c((i(),u("div",{class:"mask",onClick:a[3]||(a[3]=e=>N.value=!1),"element-loading-text":"创建中...","element-loading-background":"rgba(122, 122, 122, 0.8)"},[C(m,{name:"optMenuShow"},{default:g((()=>[N.value?(i(),u("div",{key:0,class:"addMapForm",onClick:a[2]||(a[2]=y((()=>{}),["stop"]))},[a[13]||(a[13]=d("h2",null,"新建导图",-1)),c(d("input",{type:"text",placeholder:"起个名字吧","onUpdate:modelValue":a[1]||(a[1]=e=>O.value=e)},null,512),[[r,O.value]]),d("button",{class:"addMapFormBttn b1",onClick:ee},"创建"),d("button",{class:"addMapFormBttn b2",onClick:X},"取消")])):b("",!0)])),_:1})])),[[k,N.value],[s,Q.value]])])),_:1}),C(m,{name:"fade"},{default:g((()=>[c(d("div",{class:"mask",onClick:a[8]||(a[8]=e=>oe(se.value,se.value.id))},[C(m,{name:"optMenuShow"},{default:g((()=>[te.value?(i(),u("div",{key:0,class:"optMenu",onClick:a[7]||(a[7]=y((()=>{}),["stop"]))},[d("div",z,[c(d("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=e=>se.value.title=e),onBlur:a[5]||(a[5]=e=>async function(){console.log(se.value);let e=se.value.data.data,a=se.value.data.picUrl,t=se.value.id,s=se.value.title;console.log("ok"),await _(e,s,t,a).then((e=>{o({message:"重命名成功",type:"success",duration:2500,offset:45}),G()})).catch((e=>{console.log(e),o({message:"重命名失败"+e.message,type:"error",duration:2500,offset:45})})),oe(item)}())},null,544),[[r,se.value.title]])]),d("div",{class:"optMenuItem",onClick:a[6]||(a[6]=e=>async function(){await L(se.value.id).then((e=>{console.log(e),o({message:"删除成功",type:"success",duration:2500,offset:45}),te.value=!1,ae.value=!1,G()})).catch((e=>{console.log(e),o({message:"删除失败",type:"error",duration:2500,offset:45}),te.value=!1,ae.value=!1}))}())},a[14]||(a[14]=[d("button",null," 删除导图 ",-1)]))])):b("",!0)])),_:1})],512),[[k,ae.value]])])),_:1})],512)}},__scopeId:"data-v-7b765281"};export{P as default};
