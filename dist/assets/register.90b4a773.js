import{u as e,h as a,r as s,l,o,c as r,m as t,w as u,v as n,a as c,p as i,t as m,A as d,G as v,F as p,k as f}from"./vendor.720acc60.js";import{_ as g}from"./verifyInput2.10880d17.js";import{u as y,b as w,a as _}from"./token.48e906ce.js";import{l as h}from"./login.aea3c1de.js";import"./userCenter.2a8f9ef9.js";const k={username:{rule:/^[a-zA-Z0-9]{3,20}$/,message:"用户名需由字母、数字、下划线组成，长度在3到20位之间"},password:{rule:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,20}$/,message:"密码需包含大小写字母、数字，长度6到20位"},confirmPassword:{compare:(e,a)=>e===a,message:"两次输入的密码不一致"},email:{rule:/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/,message:"请输入正确的邮箱格式"},code:{rule:e=>6===e.length,message:"请输入6位验证码"}},b=y();const P={class:"wrap"},x={class:"main"},C={class:"form"},j={class:"item1",style:{"--i":"1"}},A={key:0,class:"error-message"},I={class:"item2",style:{"--i":"2"}},z={key:0,class:"error-message"},U={class:"item1",style:{"--i":"3"}},V={key:0,class:"error-message"},Z={class:"item2",style:{"--i":"4"}},$={key:0,class:"error-message"},T={class:"button_item"},F={key:0,class:"next_wrap","element-loading-backgound":"rbga(100,100,100,0.2)"},G={class:"verify_text"},K={class:"verify_input"},M={key:1,class:"error-message"},O={__name:"register",setup(y){const O=_(),R=e(),q=a({email:"",password:"",confirmPassword:"",code:[],username:"",loginType:"password"}),B=a(!1),D=a({}),E=a("发送验证码"),H=a(!0);function J(){const{username:e,password:a,confirmPassword:s,email:l,code:o}=q.value;if(D.value={},console.log(l),k.username.rule.test(e)||(D.value.username=k.username.message),k.password.rule.test(a)||(D.value.password=k.password.message),k.confirmPassword.compare(a,s)||(D.value.confirmPassword=k.confirmPassword.message),k.email.rule.test(l)||(D.value.email=k.email.message),0===Object.keys(D.value).length){B.value=!0;let e=10;H.value=!0;const a=setInterval((()=>{E.value=`重试（${e--}s）`,0===e&&(clearInterval(a),H.value=!1,E.value="重新发送验证码")}),1e3);(function(e){return w.post(b.url+"/user/code/",{email:e.value.email})})(q).then((e=>{200===e.status&&f({message:"验证码发送成功",type:"success",duration:2500,offset:45})})).catch((e=>{console.log(e)}))}else console.log(D)}const L=a(!1);async function N(e){q.value.code=e,console.log(q.value),L.value=!0,await function(e){return w.post(b.url+"/user/register/",{email:e.value.email,password:e.value.password,code:e.value.code,username:e.value.username})}(q).then((e=>{201===e.status&&(f({message:"注册成功",type:"success",duration:2500,offset:45,onClose:void h(q,q.value.loginType).then((e=>{O.setToken(e.data.access),200===e.status&&R.push("/indexPage")})).catch((e=>{console.log(e),f({message:"登录失败",type:"error",duration:2500,offset:45})}))}),L.value=!1)})).catch((e=>{f({message:"注册失败",type:"error",duration:2500,offset:45}),console.log(e),L.value=!1}))}return(e,a)=>{const f=s("User"),y=s("el-icon"),w=s("Key"),_=s("CircleCheck"),h=s("Message"),k=s("Right"),b=l("loading");return o(),r(p,null,[t("div",P,[a[4]||(a[4]=t("div",{class:"header"},[t("span",{class:"title"},"注册")],-1)),t("div",x,[t("div",C,[t("div",j,[u(t("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>q.value.username=e),placeholder:"用户名"},null,512),[[n,q.value.username]]),c(y,{class:"label_icon"},{default:i((()=>[c(f)])),_:1}),D.value.username?(o(),r("span",A,m(D.value.username),1)):d("",!0)]),t("div",I,[c(y,{class:"label_icon"},{default:i((()=>[c(w)])),_:1}),u(t("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>q.value.password=e),placeholder:"密码"},null,512),[[n,q.value.password]]),D.value.password?(o(),r("span",z,m(D.value.password),1)):d("",!0)]),t("div",U,[u(t("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>q.value.confirmPassword=e),placeholder:"确认密码"},null,512),[[n,q.value.confirmPassword]]),c(y,{class:"label_icon"},{default:i((()=>[c(_)])),_:1}),D.value.confirmPassword?(o(),r("span",V,m(D.value.confirmPassword),1)):d("",!0)]),t("div",Z,[c(y,{class:"label_icon"},{default:i((()=>[c(h)])),_:1}),u(t("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>q.value.email=e),placeholder:"邮箱"},null,512),[[n,q.value.email]]),D.value.email?(o(),r("span",$,m(D.value.email),1)):d("",!0)]),t("div",T,[t("button",{class:"toVerify_button",onClick:J},[c(y,null,{default:i((()=>[c(k)])),_:1})])])])])]),B.value?u((o(),r("div",F,[t("div",G,[a[5]||(a[5]=t("span",null,"邮箱验证",-1)),t("p",null,"验证码已发送至："+m(q.value.email),1),t("a",{onClick:J},m(E.value),1)]),t("div",K,[B.value?(o(),v(g,{key:0,class:"verifyInput2",digitCount:6,onInputComplete:N})):d("",!0),D.value.code?(o(),r("span",M,m(D.value.code),1)):d("",!0)])])),[[b,L.value]]):d("",!0)],64)}},__scopeId:"data-v-1ca414be"};export{O as default};
