import{u as e,h as a,r as s,k as l,o,c as r,l as t,s as u,a as n,G as c,w as i,v as d,n as m,t as v,A as p,q as f,H as g,F as y,p as w}from"./vendor.a451946c.js";import{_}from"./verifyInput2.1a408f59.js";import{u as k,b as h,a as b}from"./token.a72cd05d.js";import{l as P}from"./login.43cd1ae7.js";import"./userCenter.9a6bef5c.js";const C={username:{rule:/^[a-zA-Z0-9]{3,20}$/,message:"用户名需由字母、数字、下划线组成，长度在3到20位之间"},password:{rule:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,20}$/,message:"密码需包含大小写字母、数字，长度6到20位"},confirmPassword:{compare:(e,a)=>e===a,message:"两次输入的密码不一致"},email:{rule:/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/,message:"请输入正确的邮箱格式"},code:{rule:e=>6===e.length,message:"请输入6位验证码"}},x=k();const j={class:"wrap"},A={class:"header"},I={class:"main"},z={class:"form"},U={class:"item1",style:{"--i":"1"}},V={key:0,class:"error-message"},Z={class:"item2",style:{"--i":"2"}},$={key:0,class:"error-message"},T={class:"item1",style:{"--i":"3"}},q={key:0,class:"error-message"},F={class:"item2",style:{"--i":"4"}},G={key:0,class:"error-message"},H={class:"button_item"},K={key:0,class:"next_wrap","element-loading-backgound":"rbga(100,100,100,0.2)"},M={class:"verify_text"},O={class:"verify_input"},R={key:1,class:"error-message"},B={__name:"register",setup(k){const B=b(),D=e(),E=a({email:"",password:"",confirmPassword:"",code:[],username:"",loginType:"password"}),J=a(!1),L=a({}),N=a("发送验证码"),Q=a(!0);function S(){const{username:e,password:a,confirmPassword:s,email:l,code:o}=E.value;if(L.value={},console.log(l),C.username.rule.test(e)||(L.value.username=C.username.message),C.password.rule.test(a)||(L.value.password=C.password.message),C.confirmPassword.compare(a,s)||(L.value.confirmPassword=C.confirmPassword.message),C.email.rule.test(l)||(L.value.email=C.email.message),0===Object.keys(L.value).length){J.value=!0;let e=10;Q.value=!0;const a=setInterval((()=>{N.value=`重试（${e--}s）`,0===e&&(clearInterval(a),Q.value=!1,N.value="重新发送验证码")}),1e3);(function(e){return h.post(x.url+"/user/code/",{email:e.value.email})})(E).then((e=>{200===e.status&&w({message:"验证码发送成功",type:"success",duration:2500,offset:45})})).catch((e=>{console.log(e)}))}else console.log(L)}const W=a(!1);async function X(e){E.value.code=e,console.log(E.value),W.value=!0,await function(e){return h.post(x.url+"/user/register/",{email:e.value.email,password:e.value.password,code:e.value.code,username:e.value.username})}(E).then((e=>{201===e.status&&(w({message:"注册成功",type:"success",duration:2500,offset:45,onClose:void P(E,E.value.loginType).then((e=>{B.setToken(e.data.access),200===e.status&&D.push("/indexPage")})).catch((e=>{console.log(e),w({message:"登录失败",type:"error",duration:2500,offset:45})}))}),W.value=!1)})).catch((e=>{w({message:"注册失败",type:"error",duration:2500,offset:45}),console.log(e),W.value=!1}))}return(e,a)=>{const w=s("User"),k=s("el-icon"),h=s("Key"),b=s("CircleCheck"),P=s("Message"),C=s("Right"),x=l("loading");return o(),r(y,null,[t("div",j,[t("div",A,[t("div",{class:"back_icon",onClick:a[0]||(a[0]=e=>u(D).push("/login"))},[n(u(c))]),a[6]||(a[6]=t("span",{class:"title"},"注册",-1))]),t("div",I,[t("div",z,[t("div",U,[i(t("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>E.value.username=e),placeholder:"用户名"},null,512),[[d,E.value.username]]),n(k,{class:"label_icon"},{default:m((()=>[n(w)])),_:1}),L.value.username?(o(),r("span",V,v(L.value.username),1)):p("",!0)]),t("div",Z,[n(k,{class:"label_icon"},{default:m((()=>[n(h)])),_:1}),i(t("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>E.value.password=e),placeholder:"密码"},null,512),[[d,E.value.password]]),L.value.password?(o(),r("span",$,v(L.value.password),1)):p("",!0)]),t("div",T,[i(t("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>E.value.confirmPassword=e),placeholder:"确认密码"},null,512),[[d,E.value.confirmPassword]]),n(k,{class:"label_icon"},{default:m((()=>[n(b)])),_:1}),L.value.confirmPassword?(o(),r("span",q,v(L.value.confirmPassword),1)):p("",!0)]),t("div",F,[n(k,{class:"label_icon"},{default:m((()=>[n(P)])),_:1}),i(t("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=e=>E.value.email=e),placeholder:"邮箱"},null,512),[[d,E.value.email]]),L.value.email?(o(),r("span",G,v(L.value.email),1)):p("",!0)]),t("div",H,[t("button",{class:"toVerify_button",onClick:S},[n(k,null,{default:m((()=>[n(C)])),_:1})])])])])]),J.value?i((o(),r("div",K,[t("div",M,[t("span",null,[t("div",{class:"back_icon",onClick:a[5]||(a[5]=e=>J.value=!1)},[n(u(c))]),a[7]||(a[7]=f(" 邮箱验证 "))]),t("p",null,"验证码已发送至："+v(E.value.email),1),t("a",{onClick:S},v(N.value),1)]),t("div",O,[J.value?(o(),g(_,{key:0,class:"verifyInput2",digitCount:6,onInputComplete:X})):p("",!0),L.value.code?(o(),r("span",R,v(L.value.code),1)):p("",!0)])])),[[x,W.value]]):p("",!0)],64)}},__scopeId:"data-v-621a3aad"};export{B as default};
