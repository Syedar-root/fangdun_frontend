import{h as e,q as a,s,o as l,c as o,F as t,x as u,r as n,j as r,w as i,v as c,a as d,y as m,t as p,k as v,n as f}from"./vendor.40eb074b.js";import{u as g,a as y}from"./url.910aed66.js";import{l as w}from"./login.e3a96ea0.js";import{u as h}from"./token.446bbc0f.js";const _={class:"verification-code-input"},b=["onInput","onKeydown"],x={__name:"verifyInput",props:{digitCount:{type:Number,default:4},modelValue:{type:String,default:""}},emits:["update:modelValue","input-complete"],setup(n,{emit:r}){const i=n,c=e(new Array(i.digitCount).fill("")),d=r;a((()=>{if(i.modelValue.length===i.digitCount)for(let e=0;e<i.digitCount;e++)c.value[e]=i.modelValue[e]}));return s(c.value,(()=>{if(!c.value.includes("")){const e=c.value.join("");console.log(e),d("input-complete",e)}})),(e,a)=>(l(),o("div",_,[(l(!0),o(t,null,u(c.value,((e,a)=>(l(),o("input",{key:a,type:"text",class:"input-box",maxlength:1,onInput:e=>(e=>{let a=event.target.value;if(/^\d$/.test(a)){if(c.value[e]=a,a&&e<c.value.length-1){const a=document.querySelectorAll(".input-box")[e+1];a&&a.focus()}else if(!a&&e>0){const a=document.querySelectorAll(".input-box")[e-1];a&&(a.focus(),a.value="",c.value[e-1]="")}const s=c.value.join("");d("update:modelValue",s)}else event.target.value=""})(a),onKeydown:e=>(e=>{const a=event.keyCode||event.which;if(8===a||46===a){e===c.value.length-1?(document.querySelectorAll(".input-box")[e].value="",c.value[e]="",document.querySelectorAll(".input-box")[e-1].focus()):e>0&&(c.value[e]="",document.querySelectorAll(".input-box")[e-1].focus());const a=c.value.join("");d("update:modelValue",a),console.log(a),console.log(e)}})(a)},null,40,b)))),128))]))},__scopeId:"data-v-28727198"},k={username:{rule:/^[a-zA-Z0-9]{3,20}$/,message:"用户名需由字母、数字、下划线组成，长度在3到20位之间"},password:{rule:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,20}$/,message:"密码需包含大小写字母、数字，长度6到20位"},confirmPassword:{compare:(e,a)=>e===a,message:"两次输入的密码不一致"},email:{rule:/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/,message:"请输入正确的邮箱格式"},code:{rule:e=>6===e.length,message:"请输入6位验证码"}},V=g();const C={class:"wrap"},A={class:"main"},P={class:"form"},j={class:"item1",style:{"--i":"1"}},I={key:0,class:"error-message"},q={class:"item2",style:{"--i":"2"}},S={key:0,class:"error-message"},U={class:"item1",style:{"--i":"3"}},z={key:0,class:"error-message"},Z={class:"item2",style:{"--i":"4"}},$={key:0,class:"error-message"},K={class:"button_item"},T={key:0,class:"next_wrap"},F={class:"verify_text"},M={class:"verify_input"},N={key:0,class:"error-message"},O={__name:"register",setup(a){const s=h(),u=e({email:"",password:"",confirmPassword:"",code:[],username:"",loginType:"password"}),g=e(!1),_=e({}),b=e("发送验证码"),O=e(!0);function R(){const{username:e,password:a,confirmPassword:s,email:l,code:o}=u.value;if(_.value={},console.log(l),k.username.rule.test(e)||(_.value.username=k.username.message),k.password.rule.test(a)||(_.value.password=k.password.message),k.confirmPassword.compare(a,s)||(_.value.confirmPassword=k.confirmPassword.message),k.email.rule.test(l)||(_.value.email=k.email.message),0===Object.keys(_.value).length){g.value=!0;let e=10;O.value=!0;const a=setInterval((()=>{b.value=`重试（${e--}s）`,0===e&&(clearInterval(a),O.value=!1,b.value="重新发送验证码")}),1e3);(function(e){return y.post(V.url+"/user/code/",{email:e.value.email})})(u).then((e=>{200===e.status&&f({message:"验证码发送成功",type:"success",duration:2500,offset:45})})).catch((e=>{console.log(e)}))}else console.log(_)}async function B(){await function(e){return y.post(V.url+"/user/register/",{email:e.value.email,password:e.value.password,code:e.value.code,username:e.value.username})}(u).then((e=>{200===e.status&&f({message:"验证码发送成功",type:"success",duration:2500,offset:45,onClose:void w(u).then((e=>{s.setToken(e.data.access),200===e.status&&f({message:"登录成功",type:"success",duration:2500,offset:45})})).catch((e=>{f({message:"登录失败",type:"error",duration:2500,offset:45})}))})})).catch((e=>{f({message:"注册失败",type:"error",duration:2500,offset:45}),console.log(e)}))}return(e,a)=>{const s=n("User"),f=n("el-icon"),y=n("Key"),w=n("CircleCheck"),h=n("Message"),k=n("Right");return l(),o(t,null,[r("div",C,[a[6]||(a[6]=r("div",{class:"header"},[r("span",{class:"title"},"注册")],-1)),r("div",A,[r("div",P,[r("div",j,[i(r("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>u.value.username=e),placeholder:"用户名"},null,512),[[c,u.value.username]]),d(f,{class:"label_icon"},{default:m((()=>[d(s)])),_:1}),_.value.username?(l(),o("span",I,p(_.value.username),1)):v("",!0)]),r("div",q,[d(f,{class:"label_icon"},{default:m((()=>[d(y)])),_:1}),i(r("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>u.value.password=e),placeholder:"密码"},null,512),[[c,u.value.password]]),_.value.password?(l(),o("span",S,p(_.value.password),1)):v("",!0)]),r("div",U,[i(r("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>u.value.confirmPassword=e),placeholder:"确认密码"},null,512),[[c,u.value.confirmPassword]]),d(f,{class:"label_icon"},{default:m((()=>[d(w)])),_:1}),_.value.confirmPassword?(l(),o("span",z,p(_.value.confirmPassword),1)):v("",!0)]),r("div",Z,[d(f,{class:"label_icon"},{default:m((()=>[d(h)])),_:1}),i(r("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>u.value.email=e),placeholder:"邮箱"},null,512),[[c,u.value.email]]),_.value.email?(l(),o("span",$,p(_.value.email),1)):v("",!0)]),r("div",K,[r("button",{class:"toVerify_button",onClick:R},[d(f,null,{default:m((()=>[d(k)])),_:1})])])])])]),g.value?(l(),o("div",T,[r("div",F,[a[7]||(a[7]=r("span",null,"邮箱验证",-1)),r("p",null,"验证码已发送至："+p(u.value.email),1),r("a",{onClick:R},p(b.value),1)]),r("div",M,[d(x,{modelValue:u.value.code,"onUpdate:modelValue":a[4]||(a[4]=e=>u.value.code=e),digitCount:4,onInputComplete:B},null,8,["modelValue"]),_.value.code?(l(),o("span",N,p(_.value.code),1)):v("",!0),r("button",{style:{width:"100px",height:"100px"},onClick:a[5]||(a[5]=()=>{console.log(u.value)})})])])):v("",!0)],64)}},__scopeId:"data-v-8bb15f26"};export{O as default};
